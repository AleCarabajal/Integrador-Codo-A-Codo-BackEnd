<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Filtrado de Productos</title>
    <!--===== Favicon =====-->
    <link rel="shortcut icon" href="imagenes/logo1.png" type="image/x-icon">
    <style>
        section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .card {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
            
        }
        aside {
            width: 15%;
        }
        section {
            width: 85%;
        }
        .flex {
            display: flex;
        }
        h1{
            margin-top: 50px;
        }
    </style>
</head>
<body>

    <!-- Barra de Navegación -->

    <nav
      class="navbar navbar-expand-lg navbar-dark fixed-top"
      style="background-color: rgb(26, 117, 188)"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <img
            src="imagenes/icono1.webp"
            alt=""
            
            height="40"
          >

          Clínica Odontológica
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav ms-auto">
            <a class="nav-link active" aria-current="page" href="index.html"
              >Inicio</a
            >
            <a class="nav-link" href="quienesSomos.html">Quienes Somos</a>
            <a class="nav-link" href="tratamientos.html">Tratamientos</a>
            <a class="nav-link" href="contacto.html">Contacto</a>
            <a class="nav-link" href="turnosOnline.html">Turno Online</a>
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Tienda
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="productos.html">Todos los productos</a>
                <a class="dropdown-item" href="filtrarproductos.html">Filtrar Productos</a>
                
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="loadprod.html">Cargar Producto</a>
              </div>
            <a class="nav-link" href="integrantes.html">Integrantes</a>
          </div>
        </div>
      </div>
    </nav>
    

    <div class="container" >
        <h1>Productos</h1>
        <h6>En este apartado encontrarás los mejores productos odontológicos que te acompañarán en la vida diaria, durante el cuidado de tu salud bucal.
            Recuerda utilizarlos de acuerdo a los criterios y recomendación de tu Odontólogo de confianza.</h6>
        <div class="flex">
            <aside>
                <form id="filtroForm">
                    <label for="nombre" class="form-label">Nombre:</label>
                    <input type="text" id="nombre" name="nombre" class="form-control">
    
                    <label for="precioMin" class="form-label">Precio mínimo:</label>
                    <input type="number" id="precioMin" name="precioMin" class="form-control">
    
                    <label for="precioMax" class="form-label">Precio máximo:</label>
                    <input type="number" id="precioMax" name="precioMax" class="form-control">
    
                    <label for="orden" class="form-label">Orden:</label>
                    <select id="orden" name="orden" class="form-select">
                        <option value="asc">Ascendente</option>
                        <option value="desc">Descendente</option>
                    </select>
    
                    <label for="descripcion" class="form-label">Descripción:</label>
                    <input type="text" id="descripcion" name="descripcion" class="form-control">
    
                    <input type="submit" value="Aplicar filtros" class="btn btn-primary">
                </form>
            </aside>
            <section>

            </section>
        </div>
    </div>
   

    <script>
        
        // Agregar un evento al formulario para que se ejecute cuando se envíe
        const filtroForm = document.querySelector('#filtroForm')
        filtroForm.addEventListener('submit', function(event) {
            event.preventDefault()
            // Obtengo los datos del formulario y almaceno params
            const params = new URLSearchParams(new FormData(event.target))
            // Redirijo a la URL actual con los parámetros de búsqueda
            window.location.search = params.toString() // ?nombre=pepe&apellido=argento
        })

        // Crear el string de los parámetros para enviarselo al servidor mediante FETCH.
        // Chequear la URL actual
        const url = new URL(window.location.href);

        // obtener  parámetros de búsqueda de la URL si existen 
        const params = new URLSearchParams(url.search); // ?nombre=pepe&apellido=argento

        // recorrer los parámetros de búsqueda y agregarlos a la URL
        let query = '' // ?nombre=pepe&apellido=argento
        params.forEach((value, key) => {
            query += `${key}=${value}&`
        })


        //fetch(`/api/productos?${query}`)
        fetch(`/api/productos?${query}`)
            .then(response => response.json())
            .then(data => {
                
                // Indico el contenedor en donde se mostrarán los productos
                const section = document.querySelector('section')

                // preparo el código que se mostrará en el contenedor, va a ir agregando cada bloque de codigo
                let html = ''

                // recorro el array obtenido de la API
                data.forEach(producto => {
                    
                    // por cada producto, creo un bloque de código HTML y lo SUMO al bloque de código que se mostrará
                    html += `
                        <div class="card">
                            <h2>${producto.nombre}</h2>
                            <p>${producto.descripcion}</p>
                            <strong>$ ${producto.precio} Ars</strong>
                            <small>Stock: ${producto.stock} unidades</small>
                            <a href="/editar.html/?${producto.id_producto}"  class="btn btn-primary">Editar Producto</a>
                        </div>
                    `
                    
                })
                // al terminar el recorrido, agrego el bloque de código al contenedor
               section.innerHTML = html

            })
    </script>

<script
src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
crossorigin="anonymous"
></script>
    
</body>
</html>